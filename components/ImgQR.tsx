import { useEffect, useState, ReactElement } from "react";
import Image, { ImageProps } from 'next/image'

import { createImg } from "../pages/api/QR/createImg";

type ImageQRProps = {
    message: string
}

function ImgQR({message, ...props}: ImageQRProps & Omit<ImageProps, "src">) : ReactElement{
    const placeholderQR = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAZGUlEQVR4XsWdiXLbyg5Erez79v8/md1OYt9XzZejOmqDkmzHVqpUUrSQM9NAA2gM6c1///935n/8/9Dz9JudAw3/2Ww241fW3u8v91j5nPfv+/i3mR9jOvScY2+urq62aGRSBoH/T8/5cQN2aLB87kVbG+QaENM5G6T7Pv6heU5zyntrjwUIPgeQXvSrq6tlwfPMg//7uwbm0EAbEAbhAfXryUg455pBeEEOvb7N8Q/Ns8+Z/z969GhZ9Dzz8Ps7gHiBDQCvLy8vz/JYA+YmoEyDteWsAdIGY1C8qG2FO9ZXVjoBe4gNbgpGA/H48eOzPAyMAdpcXl4uMaS9ARDy/OfPnwUQQMmzvaUBaR43pRwCBKvxxO2ta57s74+WV1Y6HX+Nom87P8AAAMB48uTJAsoEzhaQTNoLHhB4/P79+xoo9pZpwfcF43186sVkIZo224AmD9mxur+e0XTh4++Ll7edn89nMJ4+fXoWUHgYsAUQwMALDETA+PXr19kESscS6MHPE8+vURTvY1ks2BpdNlCcd42neT8LgKdOcXFKbKb4t5bYeH45Z4Px7Nmzs4BiYPjO5s+fP1tAJiACxsXFxRaUKZ60BU2UNX1nLfgZEHtux7D+DEAmjs65bIk5R3vglKzY+zq+AdLad2wAOXcACBjPnz9fnidgNr9//14ACRjxAh4AcX5+fpZHQMFL8l1bJxObAmpTASCw6A0KFmULJoZNCYc/MyBbi1NmY0tlrBkfHjhlXDnnbecHIFBTAAkYL168WB4Ag7fkeQEkA2ogAkCA+Pnz5/YBda15ybGAdJwwSA50WQiMpc+Jd2AkBH4AJXCavniPZxbaBtY0xHED1k3nZ7rCO16+fHnGA1AMzObXr18LIFlsvMJg/Pjx4+z79+8LKHgJmVd7SSbTlu8AjIt3wDX3B5AsmCkli95ZHv/PmKFazs8xDC6v4W3iCICbDp0O877HDjD9vZ5f5gD4eEfAeP369dmrV68WYBqUBZBMaA2MAPLt27ezPBNLDAgpMDHiECBMhgVxvGECbcEAYkvGq51wZAz2EIDtoJrFaUCgrY4Ld5mfASF2BIg3b94sgEygbC4uLraAEC+gqnhGHgCS951tOajeBJCOE7asLCILhgX2ObHqABQjyQOwODbHcL7PsbM4AJJxdxwyKI4vxzAAdOwEgvPGGwAkXpIHXkJcWQDJhKEpxw28I4AEGABp+rBbuzIlBpBaMqEpcJtuvGBefKzVdAUg8ZR8dwLE70EdLJhjFEblhMIptwGBUl209vw6hmTRA0I8BC9xPMnnCyCdUQWIxAw85OvXrzuAmHexzAz8mAGzELEaTxy6yfsBhM8nQHgv43YWmPdJb+0hBgTqgM46hnR8uMv8oKw8ZzwA8vbt2wUYPCRes/WQ8/PzxUOYmLMq6OrLly8LIB3UW1ZxJtIWxGfmc7yJ1JIJJOsAECgFWsHboCvGm7FlPABCqtlWmmNz/HxmyjLt+jx45E3n5+QCzwwI7969WzwEQOwlmwCChxiMvA5V5REPybMpiwUiXcaSugp3HcKCk3cDiBeCgee5F8yUBSDx5jwyNryUhXDqC48DyHR8DCNzAJC7zK8BiRcEiHgItOU0OK+3gBA78mzKChDxEAAJeGQ4LIrrk65mXWx1tQp92Xtw7VALgEw1CF7ttDzjyb9OewEGusrCAEhAIIsjHgQQEpZWKW4yPycoOTeAtIdAWSMg9hI8pAFxVU8VTz1gt3aenkkSH6hWXW9ALRl4BkZgzzEmQIgfxLmMOwtLHLNwB0AsSs7fgHRxSGy5y/ysV02AxEv2egiuDyiOIQEn77PwiI5OlTOpKVPBqrJIBC+sNIvlRQSQLBqfOdMhowMQjGYfIJYuKMQmQFyLwAJ3mR9aFYaYxQ8IUwwhJb5GWYCRgTQgWIsre1NdQDIPW4ZwpkHuTdVsQAJEPifwwuXEDwNCJoixrHmIKcuAQE3ECQMCC9xlfgiIMSxYoQHJeOwlBwEJKGuURe2CZ8Vq93kIbgtnut5whjUBYmkDg8hiUSNlDMQQwO/gTnyCsgIIntBxxOe47fw4Dx7iGELaexCQLgwnQOwhLT4SxF1jkHlBR1iEPYTFO8ZDvFiOIQ7q3WtwlgWVAEiLpvFYPOQu87OHdAyxngVjrGZZDIIMZsqyECPvMmAWDbnBAhyURbXvODIBEkPKIpI8TA0gp9QBiISBuRDYqU3iNXeZ3z8BpGPIfVMWBSApcYAIpd0EEITPLCh0hdztbIv3qOJZ+IBJskKsQnClDOA7N6Hkf0JZDx3Ul6bM326eFVFX69QEvViJYRSG1EcGFgnGfRC8MsBRg7gBxzkI9CcN6qdIey2RE3QJ+tCKVWVet7pAQhFA4OsGxAVjALEXWIWgBrGkBCXeJK3/p2mvpZP7LAyhLEvUzrIIvFMMCQhunCUm5DikmF4Qa1rUN9bD3FqwfnbSwjCTe2jphL6EqQZAXBi25G9Kgf8DXrzMnTjiRQABFCQZ2g7M26kv5zuZdJITn0JcdKVO0E1ujpZFJoSYiaeQljplzUKTNgOqASFWuSAkDlnJjodwnpOIi6eU35HprQRba2r53YAACoGYititUQDxxgoDAiMYEKfaNoQHk9/dMZz6Id2gMn10+7N3lCB9WGKnJ4L8jtZl2up+iOnEWRe1A/EDTYjEAM2Kc1GwWqsibeYcAOLzoARznH0dQ7eNed0NqtV+SLdw1wCxfAAgrcIe0zF0z9ndOXf6XDC6SJtERiQVxw82EFhmd58GIyEpcAxxS9bU5Saax93f71hFZucMMuIi0gneTNzb21NHlkiWRY/Em+UaEE966hji8gy6AYG2pk0I7YksBFINBaG32Zj68AyaT61VdQwBaGto7oVwPH+v5+fuKKl4gKBB1duBtj11S+kO7qi9pizvg7KnmJK80CwYFsakTFd+z5U1ixcwLGssmocuGKIpFSvEO1zL9LmwfCT89hBbPfHJ9QdgmNr4jeeCgVl+z7jwEG902Nl1QoHUO0+8DYhdJ2y58eY1Bm3KsrjoNq4t1RNzHHHjisUzID6Gey2Il1iee+d8DyC7KMRD7BF+3QUhRsF3vAasg+PH0R6ytlGO7KP3ZZFmeq+UB2PashUzISZiwPgev6U28eK5V2HqgP6wQnuI5ReDbw/BCL23y4mIqbENiO9NwHlcTuczPu86cUa4UBaAQFu4MdSF4uugznehEru1AYFyevEBhQW3B2FdfEam42yKcziAWilmN8caIByT7JLiz15oqp28oz9vamtAHNQBxMkHjbNls7V75NOW0ngJqSGu7S2cTSdNS00xTNBA2BINBllWg24w3OtIUMfqaAOTYNgAXFh6Z7/HhAfYgx2/2pM6TrpB5uYcKe9eQDxA+gMonWy2tq4DIC1bdybiuqRpw1bWbu/JkjzYUq1NGRDqECwOJQBv5bjUIS2NNCBNtZNXQ4H+Lmk8Y2tAAgaxzpcnXLscoakrGYj3PtEXYCKAZ47v9BdrnizVGc0EinmatJLJOq20qMgEqdJ7Ea3mujnVtAM4ptjpWDYePsdgJmPBQ24NCJTlbZt4S/Mvg3dFy8LhLRNVdT7faW17R6u3dAhRent3ooHF42x8h9LqKe6ZZpty7SF0Dntv77Th+igPcd/a22IMioOu01/LCHjKsYA4Ve3MquUJUwMFIdlaF3kkI52cMC7ozeffR7f2EB/D+8FIycmyen/vtlLnCiry8omyuByBat1dNHfbCGrOgtwUymuk785SptSRBYHq8LD2DhdgeAoaVo7hAha6csxEBehsChBac2uD4hx+n7G251Kpu1rf2dtrQJCaHdRJe6EtQHGrl+aOAemU1ILiIR52cOQ4BseA8NqgUO270g8oLLw9hHrKY+/ExFKPsyzPow2qAXHRGjDW5JMtZTFIsifvuXJxSMZlYNz+9MK5UqWvTdazlq3AxbbOfR7ihMGBlN/keK2/8X8XtwCCN3StY1CmzOuugCD1jFfhUot49yIb0vAUntGB8hsWk0lZ6WyNqi2tAeoFmYpBg9E0iXcgIrp3YoBMV13UuribvKQDfVf1eG0XrdGy2kP2AkLmxFbNiItcktDAWAXO5NtDvK8WL2HiTKglicnLHD9MWT6WF5RA69iI/tYe01S7FgM7lkyAWGS0QdLJ5PoQX5JgCf6ah3RRyOUIgGJgqE/YhG0PsXWRAQGIaaEDd6fLpropmHf2wyK1POJWL8BM3uHzd1yyxtbqg0VG01+rCOztJY449V12LvaNA0xXWfAAkH6IH+w4N22xL6pTXhaUIs01yRpPd9ZkuvMeKxZvLWNzW8GAWINr7yATxKCctTUggOLq36pCPm9A7CFNW4u4mFtrkIEwAQJ6FhxAPn/+PIICZQFIBmduZzFt6UysvQEg7Ops5fFeXY5pQPAIi5FuTVt7Y75OIFz927t7t6MTDLwb6YTjBnACv+sjmmfEkE59dwBB2+mAbkAMCtQFIFzjByCeYFt4Z0ZNRUyCxfD+KgNDxma6gIbauKy5maqQYyY6tHV7x2PHwAYk586YWAPmgfDpoO5r1reA2Kr2UVYAARQAsRKMFsSAW2sy3TBYwHHlfSwgTm27zjAgLe+YVjAgqIrmGN7K9laoa4p/BqTrGjZuWFzEMyzDbyt1357J1SvVOEGdGGJQfG2GGzyODaYse4q5mtcGhQVYoyx+40qc2OCaiiSld604RW2jwFjsIYzDNGvKsgJgGcnyiW8cwEWfvhI3mdj2flnOSrxvljjS1EXWZeGxm0j7gjMU0fTVXtWAMMGOH12Fu8fjArDV40kBcAzBQ9gnbENyhofXcV5iSHua7+Qw9tS5xZ8Bwd2R3rk02l6yBkjXIl2HOPVl4lON4ewMb7Euhhc2fzuw2mNoDzQgjnltHNahLFgCisdg2rdhYngUh/RBehvQtmPYgDRtoWU1KGzAbg+ZAIFHu1o3H68VfizKlKXlN1NAdzzBci1t8HpNpmERc06ua8+zvcSUOdGm02kMycUhwPStmnZugun0N17ijqFvIhAwnGXRbye7cOZiD3GMAIyWuA8lBBzD0gvWb1XX77VX8BnAuOLulNf9FbykMy7XIVBnp9RZB+886bsBXfMQXN8BsTc64CVTtd57Y7H4LgydxaA3eUEoLL0wVorbMrtCbut38PZ3J8/BOCbJw8CQxrpQhLI6g/MxvdGhdyziiTt3JXWmQFHlFi5ZVVfqvqRsn55lDzH/WlgEHDzIRWSnnG35XnyCqp+tbzWt2aIJxCygr63HkqEvxsTvbRA2NGibS/aaqkZA3Np0YDco3jxnCd6F1yQOtiZFDdGyh6XtFh1bt2pvmBpMLuIMiHsiphnGTsrbYEzXnvS4Wp6HLRzYvbGByy8C8rW0t9ub3nyNmGhRkZbu1Ojpat2pbutAbVnuvlFwrtEPAdR0x7n9bEDcE5l2zrgGga76NhjtJYBpI2Ce9hBABQgShh1AOo+2DtQX8rhbmNjR2zD35fZOdfM9AzGlphO1wNd+NlebGnnNwkDL3R2lcMz5XBg6diB9eN8XreKpngKY9pD2MjZB5FjX7tvrgbpr2CD0Hi1ybzIsV+uubjsOdKA1Fzvra4UWmsF78A4CsmUaJwIA4n1lLTzmWE5V4XcDwqXb7NRvIyB5AQx7CHHIWRvp/WrH0DvDHSvwCG8wsyzRbsuAsNBDgDimWPB0tT15ja2wFWYWB4/E6IiTEyAZJ9kUgPhiIANi8KG6jpkTIFCea6299+0lmLv4Awhoyq7uoHqozsjnLL7rAo7hync6lz0k3+36oUEhiZgoC4A4Jt5G7QDH931JiAEGwXK9e0COSfyOesYK9sH79vbud+/tdZ+6CyEWYKoxsGbSXccOKI+6iFjmBlMruy5EbW0GxVmddS5eQ4nMw5IHehrxxBmStTZ7VGtw7W2WYnYUjEP37QUQrg/pyxGmlNG01PWAJRIAsazhyh3KYvuqacs61SFACLwUog2ovY2Y5MBuSyYAOzPC+hEiHSP4fn8GYB17jrpvbypzb2bohbEE4WDOgsPdXYWzQC1hQGcGxDvUW2bP7zuGmAagDtOWabJfW6m1SuBYYU90qwDv6cLP9QxgMka3H466by+AYKlYGHzcgDh+OEgbECpwV9tOCBDsfL0K9cJEM+b9BsMTtwbmWscpuAs7YlMnKxYg7SHEGd8CdtKt3AXdqc9uc99ei3ikuy2Z4ClOY01XmYQ9pBMCx5C+vYUBQdB02otHAET3Msj4uoBr44EKLe1MxkcG5a4g8robUb5aCi+xBy6GfOr79mKZpglTC80yi5cNiI1hSkHtMe5luEh1EkLl32qB6yLO2RlZ73BPm9b3WGRDXL7XlLUFxB1CV+UPdd/eSdhzzdDXcLAwzvKwZgfJqTnmBlmryJZz7C0ZXxfMpPs+L4Gb24kHjPfv3y8P9mHZS8YuJDdS9o52Avh0E0y2+xDY+wqkjgNMjOrX6Z/jSFfaWZyuGaBH3ifoAyjngJNdtdtLXLTZo6CwLk5zHm/+8B2InCYjHgJIPCNgfPz4cfESNjcQ8LvhtZy/AZk85D5vz0RGZYmBytpxhNTUScAEiDWlllGcvvozPMnJCLGCjA4Zie217NbESPJbCkkDEjDyCDBQl7Uwn3uHsnwrO0C57/v2Yp1kPkyKusGAkJq6dnFyAe9PIt9auurCke+YtgA8i46qHfbw31OBuqhbYvUNyKdPn84+fPiw9ZIWJ02dB28T27caZ0Nc7wGerhFxHYI2RFpIUMtgXNjZYkh9yaSoNyZKMSDO5vbRl4PqBAixw4BM1+0T4HOuAMLOknhEvKMB8d8N8Rj2UhaXItznTTBJT9tDLAa65rGSbB3M3mMxEwrCa9yaJVXFOjknv8E7m7J8AZM34OX7AMIdrBMz4hkTIJM4eY2yuNYDynqI28TiIVMdgYf0thrrUi1MtrrcPYkGwlUySQa0ZYHTmSgNugmQGBl7eMmyCOpkW323op0YNmVZpwSEqhdLJU5Qp7iOcIBvcZNFhTYt6dgbOua0ygDg3prqi5TINvGQHNs7FENbjh8B6UaAuBHl2zP5z1WQ/7uBhaziitsxJAviStYxZArqTolb8OuGU2thUz1hujOVOU3nfVfwgO6i0NtTux4h9cVL+noQb652g2rb2VxLe305m9PehwjqdOGyQF5ssrAJEGJKg2HpBuCRbPg/oECbpjlrX6awSSF26kut4b85xeu1an0xQgPy0Pft7bSXoOvNA1ioJQp0MIpHvoMXtORhed+ftXbV8cZ0ZvB8PL8mo4MJLDR6C2n31PfGkFMUhqYsKnlnWpbXLX20QgtdtuxBHGLxpmdTLTVFZ2AO+vZEp9z5jnsm7jJOm+O6iXbyP3nk4Dt5iIOyawpnQtBSWz8B2QUkr91YI0ZN6TfVtxduy/d//yw4YDI+jApgaFgR7HuzHcfeoSy2jZ5CXOzC0BpPZ0kshit204a9Bs7n2ZV3b5rAyqFGCjY2OPQit6d22k626N+5BezN29bWTi6/E2CpH7DIbrsyYXi9q3V7hympvcSqrTdoWKBEVZhaslg3XcLOzCaNDHCILQbZss7iIbdpUKG2+tnyAYuLtTowkyE5MEMVTVlOfV1HAKI9wIF9ihFQ1drWH9MWxaPT9GmDA0qDx0amZav3vADZPfUdDzn1n14lFhBI7SETIEyeRXfh2MHcVDYBQivBm/zwRPifzXHuldtLXKh2MtAqADWK27dQ8DYunfqPEzvVtGXa+lw/dDB3j6QBaRqzLtXXrZuynCkZEO/J7VtAWdB0fGlxs7cH8TnPJ//z3ebgCRB0K4OCxuVg7UxrX9bVlOWU2PLMmofgKaacNip7hmuZ3qnC9/ydgxvlEBjdJbMC27KFF5hMyDHEwbmVWQBh4FCWK2mA6V5Ig2CLd+YVL5laws6ybBjTdRzIPk487CHTQju2OM0FjO1acL+s7hm7Q0Yq3LsHuwK2pRyrJxkUA9L9CR9v8hCDzuJaTkFOpx2LHoeX+bseh3cpkh31Fh7HQVOQNTPLPjtBfLNZZPsdQMiWehMyoPiucd5yae+weAcw9pDWmuxJvO6UEeuxbLFWhfO+z+kaxiLhVINAV/kN4yAIe5eilQQHdLx4h35qsa8FcH2+BST3OsFKWOy+dqI3MnQPwpMxGBbmpu9M2pHzckvhPpY9pL3U8omBbNpypW4wodQu7KBRd/igVHuIqatTdQf4rl+2a+E7OVhW8Ibk3q4PIM5iOug2xRwChJQR1za39sJi7a438AY/r/3Om/umObBwBsW8391Fx7iOi5PReW424OV1X6fe3uJNaZNI19YFENNidPo6WdDEwe0dWLuLwX2e0Z7aHm4QGRP00h7rgN1s0DHU4KwB1WDuXKfekkMLcZYhvBhtlQ1KeweDaEDs7p2tTQA7nuzzjI5BTXN9bMcBgOnYMFHzBEi/1/PqtdpcXV39t6YDdTXsiTjNPHYxrlnDX7V0GvQUP3phHcANei9w/87z7d8dSzFrTHAMKF4Hj235bQDpidn67TVNEcfQxLQ4HQTbYzypQ4t7E2PwPPf9rkHpRTb1Nt2tGZ3nuAZI3v8fu+ghxzvSfCoAAAAASUVORK5CYII="
    const [imageSrc, setImageSrc] = useState<string>(placeholderQR);

    useEffect(() => {
        async function fetchGenerateAPI() {
            try {
                let imageData = await createImg(message);
                setImageSrc(imageData);
            } catch (e) {
                console.error(e);                
            }
        }
        fetchGenerateAPI();
      }, [])
      let elementProps: ImageProps = {
          src: imageSrc, ...props
      } as ImageProps
      
    return(
        <>
        <Image {...elementProps}/>
        </>
    )
}

export {ImgQR};